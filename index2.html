<!DOCTYPE html>
<html>

<head>
    <title>My task</title>
    <script type="text/javascript" src="./libs/jquery-1.9.0.js"></script>
    <script type="text/javascript" src="./libs/three.js"></script>
    <script type="text/javascript" src="./libs/stats.js"></script>
    <script type="text/javascript" src="./libs/dat.gui.js"></script>
    <script type="text/javascript" src="./libs/OrbitControls.js"></script>

    <script type="text/javascript" src='./libs/threex.windowresize.js'></script>

    <script type="text/javascript" src='./libs/threex.solidwireframe.js'></script>
    <script type="text/javascript" src='./libs/threex.atmospherematerial.js'></script>
    <script type="text/javascript" src='./libs/threex.dilategeometry.js'></script>
    <script type="text/javascript" src="./libs/threex.atmospherematerialdatgui.js"></script>
    <script type="text/javascript" src="./libs/threex.geometricglowmesh.js"></script>

    <script type="text/javascript" src="./libs/Projector.js"></script>
    <script type="text/javascript" src="./libs/threex.objcoord.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            position: relative;
        }

        .text {
            position: absolute;
            color: #fff;
        }

        .text p {
            margin: 0;
        }
    </style>
</head>

<body>

    <div id="Stats-output">
    </div>
    <div id="WebGL-output">
    </div>
    <div class="text text--nanjing">
        <p>南京分支</p>
        <p>（168）</p>
    </div>
    <div class="text text--shenzhen">
        <p>深圳分支</p>
        <p>（888）</p>
    </div>

    <script type="text/javascript">

        let $shenzhenText = $('.text--shenzhen'),
            $nanjingText = $('.text--nanjing');

        let windowInnerWidth = window.innerWidth,
            windowInnerHeight = window.innerHeight;

        function randomNum(min = 0, max = 20) {
            return Math.floor(Math.random() * (max - min + 1) + min);
        }

        function getYellowSphere(scene, distance) {
            let geometry = new THREE.SphereGeometry(1.2, 15, 15);
            let material = new THREE.MeshPhongMaterial({
                wireframe: true,
                transparent: true,
                emissive: 0xD7A455,
                color: 0xD7A455,
            })
            let fragilityMesh = new THREE.Mesh(geometry, material);
            fragilityMesh.position.z = -distance;

            scene.add(fragilityMesh);

            return fragilityMesh;
        }

        function getBlueSphere(scene, distance) {
            let geometry = new THREE.SphereGeometry(randomNum(0.05, 0.08), 16, 16);
            let material = new THREE.MeshLambertMaterial({
                wireframe: true,
                emissive: new THREE.Color(0x2C6DEA),
                transparent: true
            });
            let mesh = new THREE.Mesh(geometry, material);
            mesh.position.x = distance;

            scene.add(mesh);

            return mesh;
        }

        function getDarkSphere(scene) {
            let sphereGeometry = new THREE.SphereGeometry(0.3, 15, 15);
            let sphereMaterial = new THREE.MeshLambertMaterial({
                color: 0x1c256f
            });

            let sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);

            scene.add(sphere);

            return sphere;
        }

        function init() {
            var stats = initStats();
            var scene = new THREE.Scene();
            var camera = new THREE.PerspectiveCamera(45, windowInnerWidth / windowInnerHeight, 1, 1000);
            var renderer = new THREE.WebGLRenderer({ antialias: true });

            renderer.sortObjects = false;

            renderer.setClearColor(new THREE.Color(0x0D0B31));
            renderer.setSize(windowInnerWidth, windowInnerHeight);
            renderer.shadowMap.enabled = true;

            camera.position.x = 0;
            camera.position.y = 0;
            camera.position.z = 20;
            camera.lookAt(scene.position);

            // add the output of the renderer to the html element
            document.getElementById("WebGL-output").appendChild(renderer.domElement);

            var controls = new function () {
                
            };

            // 环境光
            var ambientLight = new THREE.AmbientLight(0x2C6DEA); // soft white light
            scene.add(ambientLight);

            // 点光源
            var light = new THREE.PointLight(0x2C6DEA);
            light.position.set(0, 0, 0);
            scene.add(light);

            THREEx.WindowResize(renderer, camera);

            // 轨道控制器
            var orbitControls = new THREE.OrbitControls(camera, renderer.domElement);
            orbitControls.update();

            function getTrack(distance, scene) {
                let track = new THREE.Mesh(new THREE.RingGeometry(distance - 0.02, distance + 0.02, 64, 1),
                    new THREE.MeshBasicMaterial({ color: 0x888888, side: THREE.DoubleSide })
                );

                track.rotation.x = Math.PI / 2.2;

                scene.add(track);
                return track;
            }

            getTrack(4, scene);
            getTrack(7, scene);
            getTrack(10, scene);

            let yellowSphere = getYellowSphere(scene, 4);
            let blueSphere = getBlueSphere(scene, 4);
            getBlueSphere(scene, -7);
            getBlueSphere(scene, 10);

            let lineGeometry = new THREE.Geometry();
            vertices = lineGeometry.vertices;

            let sphere01 = getDarkSphere(scene);
            sphere01.position.y = -5;
            sphere01.position.x = 6;


            var curve = new THREE.CubicBezierCurve3(
                blueSphere.position,
                new THREE.Vector3(blueSphere.position.x, sphere01.position.y / 2 , blueSphere.position.z),
                new THREE.Vector3(sphere01.position.x, sphere01.position.y / 2 , sphere01.position.z),
                sphere01.position
            );
            var points = curve.getPoints( 50 );
            var geometry = new THREE.BufferGeometry().setFromPoints( points );

            let material = new THREE.LineBasicMaterial({ color: 0x00ffff, linewidth: 1 });
            let line = new THREE.Line(geometry, material);
            scene.add(line);

            // GUI
            var gui = new dat.GUI();

            render();

            function render() {
                stats.update();
                orbitControls.update();

                requestAnimationFrame(render);
                renderer.render(scene, camera);
            }

            function initStats() {

                var stats = new Stats();

                stats.setMode(0); // 0: fps, 1: ms

                // Align top-left
                stats.domElement.style.position = 'absolute';
                stats.domElement.style.left = '0px';
                stats.domElement.style.top = '0px';

                document.getElementById("Stats-output").appendChild(stats.domElement);

                return stats;
            }
        }

        window.onload = init;

    </script>
</body>

</html>